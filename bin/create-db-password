#!/bin/bash

if [[ "${BASH_SOURCE[0]}" != "${0}" ]]; then
  echo "This script is intended to be run, not sourced." >&2
  return 1
fi

set -e

read -srp "Enter the new DB server password: " db_pass
echo
read -srp "Re-enter the password: " db_pass2
echo
if [ ! "${db_pass}" = "${db_pass2}" ]; then
  echo "Passwords do not match." 1>&2
  exit 1
fi
[[ -z "${db_pass}" ]] && echo "DB password cannot be blank." 1>&2 && exit 1

printf '%s' "${db_pass}" | podman secret create quipucords-db-password --replace -
podman secret ls --filter name=quipucords-db-password
